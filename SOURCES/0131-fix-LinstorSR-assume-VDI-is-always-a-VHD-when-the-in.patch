From 32ecbab86a91729a8b2d2f11830a8354d0a78a62 Mon Sep 17 00:00:00 2001
From: Ronan Abhamon <ronan.abhamon@vates.fr>
Date: Thu, 28 Sep 2023 16:00:02 +0200
Subject: [PATCH 131/180] fix(LinstorSR): assume VDI is always a VHD when the
 info is missing during cleanup

Signed-off-by: Ronan Abhamon <ronan.abhamon@vates.fr>
---
 drivers/cleanup.py | 8 ++++----
 1 file changed, 4 insertions(+), 4 deletions(-)

diff --git a/drivers/cleanup.py b/drivers/cleanup.py
index 19d03d9..5353e9a 100755
--- a/drivers/cleanup.py
+++ b/drivers/cleanup.py
@@ -2995,11 +2995,11 @@ class LinstorSR(SR):
                         not list(volumes_metadata[vdi_uuid].items()):
                     continue  # Ignore it, probably deleted.
 
-                vdi_type = volumes_metadata[vdi_uuid][VDI_TYPE_TAG]
-                if vdi_type == vhdutil.VDI_TYPE_VHD:
-                    info = self._vhdutil.get_vhd_info(vdi_uuid)
-                else:
+                vdi_type = volumes_metadata[vdi_uuid].get(VDI_TYPE_TAG)
+                if vdi_type == vhdutil.VDI_TYPE_RAW:
                     info = None
+                else:
+                    info = self._vhdutil.get_vhd_info(vdi_uuid)
             except Exception as e:
                 Util.log(
                     ' [VDI {}: failed to load VDI info]: {}'
-- 
2.46.0

