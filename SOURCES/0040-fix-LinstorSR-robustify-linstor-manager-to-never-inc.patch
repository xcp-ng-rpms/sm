From 594aaa43b1e7cf6d067635f195ab9a40f304b041 Mon Sep 17 00:00:00 2001
From: Ronan Abhamon <ronan.abhamon@vates.fr>
Date: Thu, 26 Aug 2021 15:26:11 +0200
Subject: [PATCH 040/162] fix(LinstorSR): robustify linstor-manager to never
 include from plugins path

Signed-off-by: Ronan Abhamon <ronan.abhamon@vates.fr>
---
 drivers/linstor-manager | 8 ++++++--
 1 file changed, 6 insertions(+), 2 deletions(-)

diff --git a/drivers/linstor-manager b/drivers/linstor-manager
index dcd4bc6..f12747f 100755
--- a/drivers/linstor-manager
+++ b/drivers/linstor-manager
@@ -14,14 +14,18 @@
 # You should have received a copy of the GNU General Public License
 # along with this program.  If not, see <https://www.gnu.org/licenses/>.
 
+# We must modify default import path, we don't want to import modules
+# installed in plugins folder and instead we must import from LINSTOR driver
+# folder.
+import sys
+sys.path[0] = '/opt/xensource/sm/'
+
 import base64
 import distutils.util
 import time
 import subprocess
-import sys
 import XenAPIPlugin
 
-sys.path.append('/opt/xensource/sm/')
 from linstorjournaler import LinstorJournaler
 from linstorvolumemanager import get_controller_uri, LinstorVolumeManager
 from lock import Lock
-- 
2.43.0

