From 8f14abe6de2f1c7ca17108d46b0218d6bb91cda2 Mon Sep 17 00:00:00 2001
From: Ronan Abhamon <ronan.abhamon@vates.fr>
Date: Tue, 26 Oct 2021 10:44:00 +0200
Subject: [PATCH 046/170] feat(LinstorSR): explain on which host, plugins
 commands are executed

Signed-off-by: Ronan Abhamon <ronan.abhamon@vates.fr>
---
 drivers/LinstorSR.py | 24 ++++++++++++++++++------
 1 file changed, 18 insertions(+), 6 deletions(-)

diff --git a/drivers/LinstorSR.py b/drivers/LinstorSR.py
index 4b761b5..519afb2 100755
--- a/drivers/LinstorSR.py
+++ b/drivers/LinstorSR.py
@@ -775,13 +775,25 @@ class LinstorSR(SR.SR):
     # Network.
     # --------------------------------------------------------------------------
 
-    def _exec_manager_command(self, host, command, args, error):
-        ret = self.session.xenapi.host.call_plugin(
-            host, self.MANAGER_PLUGIN, command, args
-        )
+    def _exec_manager_command(self, host_ref, command, args, error):
+        host_rec = self.session.xenapi.host.get_record(host_ref)
+        host_uuid = host_rec['uuid']
+
+        try:
+            ret = self.session.xenapi.host.call_plugin(
+                host_ref, self.MANAGER_PLUGIN, command, args
+            )
+        except Exception as e:
+            util.SMlog(
+                'call-plugin on {} ({}:{} with {}) raised'.format(
+                    host_uuid, self.MANAGER_PLUGIN, command, args
+                )
+            )
+            raise e
+
         util.SMlog(
-            'call-plugin ({}:{} with {}) returned: {}'.format(
-                self.MANAGER_PLUGIN, command, args, ret
+            'call-plugin on {} ({}:{} with {}) returned: {}'.format(
+                host_uuid, self.MANAGER_PLUGIN, command, args, ret
             )
         )
         if ret == 'False':
-- 
2.44.0

